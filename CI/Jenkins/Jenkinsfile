/* groovylint-disable GStringExpressionWithinString, NestedBlockDepth */
pipeline {
    agent any
    environment {
        FOLDER_GLPI = '/usr/share/'
    }
    stages {
        stage('Collect Variables') {
            steps {
                echo "Version Choice is: ${GLPI_VERSION}"
                echo "SO Versions is: ${SO_VERSION}"
                echo "Folder GLPI is: ${FOLDER_GLPI}"
            }
        }
        stage('Prepare Environment') {
            steps {
                script {
                    sh 'sudo rm -rf ${FOLDER_GLPI}'
                    sh 'sudo mkdir ${FOLDER_GLPI}'
                    withEnv(['TAG_URL=curl -s https://api.github.com/repos/glpi-project/glpi/releases/tags/${SO_VERSION} | grep browser_download_url']){
                        sh 'sudo wget ${TAG_URL} -P ${FOLDER_GLPI}'
                    }
                }
            }
        }
    }
}
